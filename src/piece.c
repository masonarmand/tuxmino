/*
 * File: piece.c
 * -------------
 * Rotation rules and piece matrixes
 *
 * Original Author: Mason Armand
 * Contributors:
 * Date Created: Sep 14, 2022
 * Last Modified: Feb 9, 2023
 */

#include "tuxmino.h"

// internal functions
void copyPieceMatrix(const int matrix[7][4][4][4]);

// global externs
int pieces[7][4][4][4];
enum rotationSystems rotationRule;


// I piece = 0
// T piece = 1
// L piece = 2
// J piece = 3
// S piece = 4
// Z piece = 5
// O piece = 6

static const int classicRotation[7][4][4][4] = {
    // I piece
    {

        {
            {0,0,0,0},
            {3,3,3,3},
            {0,0,0,0},
            {0,0,0,0}
        },
        {
            {0,0,3,0},
            {0,0,3,0},
            {0,0,3,0},
            {0,0,3,0}
        },
        {
            {0,0,0,0},
            {3,3,3,3},
            {0,0,0,0},
            {0,0,0,0}
        },
        {
            {0,0,3,0},
            {0,0,3,0},
            {0,0,3,0},
            {0,0,3,0}
        },
    },

    // T piece
    {
        {
            {0,0,0,0},
            {6,6,6,0},
            {0,6,0,0},
            {0,0,0,0},
        },
        {
            {0,6,0,0},
            {6,6,0,0},
            {0,6,0,0},
            {0,0,0,0},
        },
        {
            {0,0,0,0},
            {0,6,0,0},
            {6,6,6,0},
            {0,0,0,0},
        },
        {
            {0,6,0,0},
            {0,6,6,0},
            {0,6,0,0},
            {0,0,0,0},
        },
    },

    // L piece
    {
        {
            {0,0,0,0},
            {7,7,7,0},
            {7,0,0,0},
            {0,0,0,0},
        },
        {
            {7,7,0,0},
            {0,7,0,0},
            {0,7,0,0},
            {0,0,0,0},
        },
        {
            {0,0,0,0},
            {0,0,7,0},
            {7,7,7,0},
            {0,0,0,0},
        },
        {
            {0,7,0,0},
            {0,7,0,0},
            {0,7,7,0},
            {0,0,0,0},
        },
    },

    // J piece
    {
        {
            {0,0,0,0},
            {1,1,1,0},
            {0,0,1,0},
            {0,0,0,0},
        },
        {
            {0,1,0,0},
            {0,1,0,0},
            {1,1,0,0},
            {0,0,0,0},
        },
        {
            {0,0,0,0},
            {1,0,0,0},
            {1,1,1,0},
            {0,0,0,0},
        },
        {
            {0,1,1,0},
            {0,1,0,0},
            {0,1,0,0},
            {0,0,0,0},
        },
    },

    // S piece
    {
        {
            {0,0,0,0},
            {0,2,2,0},
            {2,2,0,0},
            {0,0,0,0},
        },
        {
            {2,0,0,0},
            {2,2,0,0},
            {0,2,0,0},
            {0,0,0,0},
        },
        {
            {0,0,0,0},
            {0,2,2,0},
            {2,2,0,0},
            {0,0,0,0},
        },
        {
            {2,0,0,0},
            {2,2,0,0},
            {0,2,0,0},
            {0,0,0,0},
        },
    },

    // Z piece
    {
        {
            {0,0,0,0},
            {4,4,0,0},
            {0,4,4,0},
            {0,0,0,0},
        },
        {
            {0,0,4,0},
            {0,4,4,0},
            {0,4,0,0},
            {0,0,0,0},
        },
        {
            {0,0,0,0},
            {4,4,0,0},
            {0,4,4,0},
            {0,0,0,0},
        },
        {
            {0,0,4,0},
            {0,4,4,0},
            {0,4,0,0},
            {0,0,0,0},
        },
    },
    // O piece
    {
        {
            {0,0,0,0},
            {0,5,5,0},
            {0,5,5,0},
            {0,0,0,0},
        },
        {
            {0,0,0,0},
            {0,5,5,0},
            {0,5,5,0},
            {0,0,0,0},
        },
        {
            {0,0,0,0},
            {0,5,5,0},
            {0,5,5,0},
            {0,0,0,0},
        },
        {
            {0,0,0,0},
            {0,5,5,0},
            {0,5,5,0},
            {0,0,0,0},
        },
    }
};

static const int worldRotation[7][4][4][4] =
{
    // I piece
    {
        {
            {0,0,0,0},
            {6,6,6,6},
            {0,0,0,0},
            {0,0,0,0},
        },
        {
            {0,0,6,0},
            {0,0,6,0},
            {0,0,6,0},
            {0,0,6,0},
        },
        {
            {0,0,0,0},
            {0,0,0,0},
            {6,6,6,6},
            {0,0,0,0},
        },
        {
            {0,6,0,0},
            {0,6,0,0},
            {0,6,0,0},
            {0,6,0,0},
        },
    },
    // T piece
    {
        {
            {0,0,0,0},
            {0,2,0,0},
            {2,2,2,0},
            {0,0,0,0},
        },
        {
            {0,0,0,0},
            {0,2,0,0},
            {0,2,2,0},
            {0,2,0,0},
        },
        {
            {0,0,0,0},
            {0,0,0,0},
            {2,2,2,0},
            {0,2,0,0},
        },
        {
            {0,0,0,0},
            {0,2,0,0},
            {2,2,0,0},
            {0,2,0,0},
        },
    },
    // L piece
    {
        {
            {0,0,0,0},
            {0,0,7,0},
            {7,7,7,0},
            {0,0,0,0},
        },
        {
            {0,0,0,0},
            {0,7,0,0},
            {0,7,0,0},
            {0,7,7,0},
        },
        {
            {0,0,0,0},
            {0,0,0,0},
            {7,7,7,0},
            {7,0,0,0},
        },
        {
            {0,0,0,0},
            {7,7,0,0},
            {0,7,0,0},
            {0,7,0,0},
        },
    },
    // J piece
    {
        {
            {0,0,0,0},
            {1,0,0,0},
            {1,1,1,0},
            {0,0,0,0},
        },
        {
            {0,0,0,0},
            {0,1,1,0},
            {0,1,0,0},
            {0,1,0,0},
        },
        {
            {0,0,0,0},
            {0,0,0,0},
            {1,1,1,0},
            {0,0,1,0},
        },
        {
            {0,0,0,0},
            {0,1,0,0},
            {0,1,0,0},
            {1,1,0,0},
        },
    },
    // S piece
    {
        {
            {0,0,0,0},
            {0,4,4,0},
            {4,4,0,0},
            {0,0,0,0},
        },
        {
            {0,0,0,0},
            {0,4,0,0},
            {0,4,4,0},
            {0,0,4,0},
        },
        {
            {0,0,0,0},
            {0,0,0,0},
            {0,4,4,0},
            {4,4,0,0},
        },
        {
            {0,0,0,0},
            {4,0,0,0},
            {4,4,0,0},
            {0,4,0,0},
        },
    },
    // Z piece
    {
        {
            {0,0,0,0},
            {3,3,0,0},
            {0,3,3,0},
            {0,0,0,0},
        },
        {
            {0,0,0,0},
            {0,0,3,0},
            {0,3,3,0},
            {0,3,0,0},
        },
        {
            {0,0,0,0},
            {0,0,0,0},
            {3,3,0,0},
            {0,3,3,0},
        },
        {
            {0,0,0,0},
            {0,3,0,0},
            {3,3,0,0},
            {3,0,0,0},
        },
    },
    // O piece
    {
        {
            {0,0,0,0},
            {0,5,5,0},
            {0,5,5,0},
            {0,0,0,0},
        },
        {
            {0,0,0,0},
            {0,5,5,0},
            {0,5,5,0},
            {0,0,0,0},
        },
        {
            {0,0,0,0},
            {0,5,5,0},
            {0,5,5,0},
            {0,0,0,0},
        },
        {
            {0,0,0,0},
            {0,5,5,0},
            {0,5,5,0},
            {0,0,0,0},
        },
    },
};


void copyPieceMatrix(const int matrix[7][4][4][4]) {
    for (int d = 0; d < 7; d++) {
        for (int z = 0; z < 4; z++) {
            for (int y = 0; y < 4; y++) {
                for (int x = 0; x < 4; x++) {
                        pieces[d][z][y][x] = matrix[d][z][y][x];
                }
            }
        }
    }
}


void setRotationRule(int type) {
    switch (type) {
        case 0:
            copyPieceMatrix(classicRotation);
            rotationRule = CLASSIC;
        break;

        case 1:
            copyPieceMatrix(worldRotation); rotationRule = WORLD;
        break;

        default:
            copyPieceMatrix(classicRotation); rotationRule = CLASSIC;
        break;
    }
}

